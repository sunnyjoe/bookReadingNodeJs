<html>
   <style>
      body {font-family: "Lato", sans-serif;}
      /* Change background color of links on hover */
      ul.tab {
      list-style-type: none;
      margin: 0;
      padding: 0;
      overflow: hidden;
      border: 1px solid #ccc;
      background-color: #f1f1f1;
      }
      /* Float the list items side by side */
      ul.tab li {float: left;}
      /* Style the links inside the list items */
      ul.tab li a {
      display: inline-block;
      color: black;
      text-align: center;
      padding: 14px 16px;
      text-decoration: none;
      transition: 0.3s;
      font-size: 17px;
      }
      /* Change background color of links on hover */
      ul.tab li a:hover {
      background-color: #ddd;
      }
      /* Create an active/current tablink class */
      ul.tab li a:focus, .active {
      background-color: #ccc;
      }
      /* Style the tab content */
      .tabcontent {
      display: none;
      padding: 6px 12px;
      -webkit-animation: fadeEffect 1s;
      animation: fadeEffect 1s;
      }

      th, td{
      text-align: center;
      float: center;
      width: 200px;
      border-width: 0px;
      border-bottom: 1px black;
      border-style: solid;
      }
      .divLogOut {
      float:right;
      }

      .headerBgimg {
          background-image: url('images?name=arkBanner.jpg');
          background-clip: content-box;
      }

   </style>
   <body>

      <center>

      <div id="header" class="headerBgimg">
        <br>
        <h1>方舟小书馆</h1>
      <span><a href="/addbook">添加新书</a></span>
      <span><a href="/searchbook">图书检索借阅</a></span>
      <br>
      <br><br>
    </div>

<ul class="tab">
   <li><a href="#" class="tablinks" onclick="openTab(event, 'first')" id="firstTab">最新添加的图书</a></li>
   <li><a href="#" class="tablinks" onclick="openTab(event, 'second')">最受欢迎的书</a></li>
</ul>

      <div id="first" class="tabcontent">
         <button type="button" width= 50px onclick="reloadNewAddedBooks()">刷新</button>
         <table>
            <th>书名</th>
            <th>作者</th>
         </table>
         <div id="id01"></div>
    </div>

      <div id="second" class="tabcontent">
        <button type="button" width= 50px onclick="reloadPopularBooks()">刷新</button>
        <table>
           <th>书名</th>
           <th>作者</th>
        </table>
        <div id="id02"></div>
      </div>

</center>
      <script>

      reloadNewAddedBooks();
      document.getElementById('firstTab').click();

                     function openTab(evt, tabName) {
                         var i, tabcontent, tablinks;
                         tabcontent = document.getElementsByClassName("tabcontent");
                         for (i = 0; i < tabcontent.length; i++) {
                             tabcontent[i].style.display = "none";
                         }
                         tablinks = document.getElementsByClassName("tablinks");
                         for (i = 0; i < tablinks.length; i++) {
                             tablinks[i].className = tablinks[i].className.replace(" active", "");
                         }
                         evt.currentTarget.className += " active";
                         document.getElementById(tabName).style.display = "block";

                         if (tabName == "first") {
                           reloadNewAddedBooks();
                         } else {
                           reloadPopularBooks();
                         }
                     }


          function reloadNewAddedBooks(){
           var xhttp = new XMLHttpRequest();
           xhttp.onreadystatechange = function() {
             if (this.readyState == 4 && this.status == 200) {
                 parseJsonToTable(this.responseText, "id01");
             }};
           xhttp.open("GET", "newaddedbook", true);
           xhttp.send()
         }

         function reloadPopularBooks(){
          var xhttp = new XMLHttpRequest();
          xhttp.onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 200) {
                parseJsonToTable(this.responseText, "id02");
            }};
          xhttp.open("GET", "popularbooks", true);
          xhttp.send()
         }

         var list=new Array; ///this one way of declaring array in javascript

         function parseJsonToTable(response, tableId) {
           var arr = JSON.parse(response);
           list = arr;

           var i;
           var out = "<table>";

           for(i = 0; i < arr.length; i++) {
              out += "<tr onclick=selectrow("+i+")>";
              out += "<td>" + arr[i].name + "</td>";
              out += "<td>" + arr[i].author + "</td>"
                +"</tr>";
           }
              out += "</table>";
              document.getElementById(tableId).innerHTML = out;
         }

         function selectrow(index) {
           var bookid = list[index].bookid;
           var name = list[index].name;
           var author = list[index].author;

           window.location.href = "bookdetail?bookid="+bookid+"&name="+name+"&author="+author;
        }


      </script>
   </body>
</html>
